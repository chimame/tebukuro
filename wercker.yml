box: ruby:2.3.1

services:
  - id: postgres
    env:
      POSTGRES_PASSWORD: secret_password

build:
  steps:
    - install-packages:
      packages: nodejs
    - bundle-install

backend-request-spec:
  steps:
    - install-packages:
      packages: nodejs
    - bundle-install
    - rails-database-yml:
      service: postgresql-docker
    - script:
      name: Prepare database
      code: bundle exec rake db:test:prepare
    - script:
      name: Run request spec
      code: bin/rake spec:requests

backend-model-spec:
  steps:
    - bundle-install
    - script:
      name: Prepare database
      code: bundle exec rake db:test:prepare
    - script:
      name: Run model spec
      code: bin/rake spec:models
